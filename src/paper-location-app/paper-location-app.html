<link rel="import" href="../../bower_components/polymer/polymer-element.html">
<link rel="import" href="../../bower_components/paper-button/paper-button.html">

<dom-module id="paper-location-app">
    <template>
        <style>
            .container {
                display: flex;
                flex-direction: row;
            }
        </style>
        <div class="container">
            <canvas id="map" width="900px" height="600px" style="border:1px solid grey;">
                Tu navegador no soporta canvas.
            </canvas>
            <div class="control">
                <paper-button on-tap="zoomPlus">More</paper-button>
                <paper-button on-tap="zoomLess">Less</paper-button>
                <hr>
                <paper-button on-tap="moveUp">Up</paper-button>
                <paper-button on-tap="moveDown">Down</paper-button>
                <paper-button on-tap="moveRight">Right</paper-button>
                <paper-button on-tap="moveLeft">Left</paper-button>
            </div>
        </div>
    </template>

    <script>
        'use strict';
        (function AppDefinition(customElements) {
            /**
             * @customElement
             * @polymer
             */
            class PaperLocationApp extends Polymer.Element {
                static get is() {
                    return 'paper-location-app';
                }

                static get properties() {
                    return {
                        context: {
                            type: Object,
                            value: {}
                        },
                        scale: {
                            type: Number,
                            value: 1
                        },
                        size: {
                            type: Object,
                            value: {
                                width: 900,
                                height: 600,
                                index: 0
                            }
                        },
                        position: {
                            type: Object,
                            value: {
                                x: 0,
                                y: 0
                            }
                        }
                    };
                }

                connectedCallback() {
                    super.connectedCallback();
                    this.__initCanvas();
                }

                // Zoom methods

                zoomPlus() {
                    if (this.size.index < 10) {
                        this.set('size.width', this.size.width * 1.1);
                        this.set('size.height', this.size.height * 1.1);
                        this.set('size.index', this.size.index + 1);

                        this.set('position.x', this.position.x - 90);
                        this.set('position.y', this.position.y - 60);

                        this.__renderImage();
                    }
                }

                zoomLess() {
                    if (this.size.index > 0) {
                        this.set('size.width', this.size.width * 0.9);
                        this.set('size.height', this.size.height * 0.9);
                        this.set('size.index', this.size.index - 1);

                        this.set('position.x', this.position.x + 90);
                        this.set('position.y', this.position.y + 60);
                        this.__renderImage();
                    }
                }

                // Move methods

                moveUp() {
                    this.set('position.y', this.position.y + 10 + (3 * this.size.index));
                    this.__renderImage();
                }

                moveDown() {
                    this.set('position.y', this.position.y - 10 - (3 * this.size.index));
                    this.__renderImage();
                }

                moveRight() {
                    this.set('position.x', this.position.x - 10 - (3 * this.size.index));
                    this.__renderImage();
                }

                moveLeft() {
                    this.set('position.x', this.position.x + 10 + (3 * this.size.index));
                    this.__renderImage();
                }

                // Protected methods

                __initCanvas() {
                    let canvas = this.$.map;
                    this.set('context', canvas.getContext('2d'));
                    this.__renderImage(this.position.x, this.position.y, this.size.width, this.size.height);
                }

                __renderImage() {
                    this.$.map.width = this.$.map.width;
                    let imageObj = new Image();
                    imageObj.src = 'img/canvas.jpg';
                    imageObj.onload = () => {
                        this.context.drawImage(imageObj, this.position.x, this.position.y, this.size.width, this.size.height);
                    }
                }
            }

            customElements.define(PaperLocationApp.is, PaperLocationApp);
        })(window.customElements);
    </script>
</dom-module>
